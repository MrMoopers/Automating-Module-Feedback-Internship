{"version":"0.2.0","body":"function main(workbook: ExcelScript.Workbook) {\n    // Your code here\n    //let moduleId = 'CMP6002B';\n    //let moduleId = 'CMP6006A';\n\n\n    //moduleId = 'CMP6006A';\n    // surveyTable = 2 or surveyTable = 3\n    //let surveyTable = 1\n\n    //console.log(moduleId);\n    //console.log('\\n\\n');\n    //console.log(html);\n\n    //!!!!!!!!!!!!!\n    //Remove: // Below\n\n    //Module Specification Data\n    let dataSheet = workbook.getWorksheets()[0];\n    let dataTable = dataSheet.getTables()[0].getRangeBetweenHeaderAndTotal().getValues();\n    let dataHeaders = dataSheet.getTables()[0].getHeaderRowRange().getValues();\n\n\n    let responses = dataTable.length;\n    // console.log(`responses = ${responses}`)\n\n    if (workbook.getWorksheets().length > 1)\n    {\n      workbook.getWorksheets()[2].delete();\n      workbook.getWorksheets()[1].delete();\n    }\n\n    workbook.addWorksheet(\"Report\");\n    let reportSheet = workbook.getWorksheet(\"Report\");\n    reportSheet.addTable('A1', true)\n    let reportTable = reportSheet.getTables()[0];\n\n    reportSheet.addTable('C1', true)\n    let reportCommentsTable = reportSheet.getTables()[1];\n\n    workbook.getApplication().setCalculationMode(ExcelScript.CalculationMode.automatic)\n\n    //workbook.getApplication().setCalculationMode(ExcelScript.CalculationMode.manual);\n\n    \n\n\n\n    // console.log(dataHeaders[0].length);\n\n    let sum = 0;\n    let averageResult = 0;\n    let medianResult = 0;\n\n  //=AVERAGE(Table1[1. I found the module to be intellectually  stimulating])\n\n  //reportSheet.getRange(\"C3\").setValue(\"=6*2\");\n  //reportSheet.getRange(\"C4\").setValue(\"=42/3\");\n\n  reportTable.addColumn(-1, null, 'Average');\n  reportTable.addColumn(-1, null, 'Median');\n  reportTable.addColumn(-1, null, 'Mode');\n  reportTable.addColumn(-1, null, 'Strongly Disagree Count');\n  reportTable.addColumn(-1, null, 'Disagree Count');\n  reportTable.addColumn(-1, null, 'Neither Count');\n  reportTable.addColumn(-1, null, 'Agree Count');\n  reportTable.addColumn(-1, null, 'Strongly Agree Count');\n\n  reportTable.addColumn(-1, null, 'NSS Metric (%)');\n  reportTable.getColumnByName('Column1').setName('Question');\n\n  reportCommentsTable.getColumnByName('Column1').setName('Question');\n  for (let k = 0; k < responses;k++)\n  {\n    reportCommentsTable.addColumn(-1, null, `Response${k+1}`);\n  }\n\n    let cell_address = '';\n    let range_address = '';\n    let questionResults:Array<number> = [];\n    //Skip the time by starting at index 1.\n    let commentCounter = 0;\n    for (let i = 1; i < dataHeaders[0].length;i++)\n    {\n        //='Sheet1'!D24\n      cell_address = '';\n      cell_address = dataSheet.getCell(1, i).getAddress().toString();\n      \n      console.log(cell_address);\n      cell_address = cell_address.substring(7, cell_address.length - 1);\n      range_address = cell_address + ':' + cell_address.substring(0, cell_address.length);\n\n      console.log(cell_address);\n\n      //Sheet1!B2\n      \n      if (dataHeaders[0][i][dataHeaders[0][i].toString().length - 1] != '*')\n      {\n        reportTable.addRow(-1, \n          [\n            dataHeaders[0][i],\n            `=IFERROR(AVERAGE(Sheet1!${range_address}), -1)`,\n            `=IFERROR(MEDIAN(Sheet1!${range_address}), -1)`,\n            `=IFNA(MODE.SNGL(Sheet1!${range_address}),-1)`,\n            \n            `=COUNTIF(Sheet1!${range_address}, 1)`,\n            `=COUNTIF(Sheet1!${range_address}, 2)`,\n            `=COUNTIF(Sheet1!${range_address}, 3)`,\n            `=COUNTIF(Sheet1!${range_address}, 4)`,\n            `=COUNTIF(Sheet1!${range_address}, 5)`,\n            `=(SUM(COUNTIF(Sheet1!${range_address}, 4), COUNTIF(Sheet1!${range_address}, 5)) / \n              SUM(COUNTIF(Sheet1!${range_address}, 1), COUNTIF(Sheet1!${range_address}, 2),\n                  COUNTIF(Sheet1!${range_address}, 3), COUNTIF(Sheet1!${range_address}, 4),\n                  COUNTIF(Sheet1!${range_address}, 5))) * 100`\n          ]);\n\n/*\n=SUM(COUNTIF(Report!${ range_address }, 1),COUNTIF(Report!${ range_address }, 2),COUNTIF(Report!${ range_address }, 3),COUNTIF(Report!${ range_address }, 4),COUNTIF(Report!${ range_address }, 5))\n          =SUM(\n            COUNTIF(Report!${ range_address }, 1),\n            COUNTIF(Report!${ range_address }, 2),\n            COUNTIF(Report!${ range_address }, 3),\n            COUNTIF(Report!${ range_address }, 4),\n            COUNTIF(Report!${ range_address }, 5))\n\n*/\n          //`=(SUM(Report!H${(i * 2) + 2}:I${(i * 2) + 2}) / SUM(Report!E${(i * 2) + 2}:I${(i * 2)+2}) * 100)`\n\n          //Double check 5 is strongly agree\n\n        reportTable.addRow(-1,\n          [\n            '', '', '', '', '', '', '', '', '',''\n          ]);\n\n          // console.log(i);\n      }\n      else\n      {\n        // reportTable.addRow(-1,\n        //   [\n        //     dataHeaders[0][i], ' ', '', '', '', '', '', '', ''\n        //   ]);\n\n        // reportTable.addRow(-1,\n        //   [\n        //     '', '', '', '', '', '', '', '', ''\n        //   ]);\n\n\n\n        let newReportCommentsTableRow:Array<string> = [];\n        let emptyReportCommentsTableRow: Array<string> = [];\n\n        newReportCommentsTableRow.push(dataHeaders[0][i].toString());\n        emptyReportCommentsTableRow.push('');\n        for (let x = 2; x < 2 + responses; x++) {\n          newReportCommentsTableRow.push(`=Sheet1!${cell_address}${x}`);\n          emptyReportCommentsTableRow.push('');\n        }\n\n        // console.log(newReportCommentsTableRow);\n        reportCommentsTable.addRow(-1, newReportCommentsTableRow);\n\n        reportCommentsTable.addRow(-1, emptyReportCommentsTableRow);\n\n        commentCounter++;\n      }\n    }\n// - commentCounter\n  for (let j = ((dataHeaders[0].length - commentCounter) * 2) - 3; j > 0;j-=2)\n   {\n     //console.log(j)\n     reportTable.deleteRowsAt(j, 1);\n   }\n\n  for (let j = ((commentCounter) * 2) - 1; j > 0; j -= 2) {\n    // console.log(j)\n    reportCommentsTable.deleteRowsAt(j, 1);\n  }\n\n\n\n  \n  workbook.addWorksheet(\"Graphs\");\n  let graphsSheet = workbook.getWorksheets()[2];\n\n  let numberOfQuestions = dataHeaders[0].length - commentCounter - 1;\n  let barChart = graphsSheet.addChart(ExcelScript.ChartType.barStacked, reportSheet.getRange(`A1:B${numberOfQuestions}`));\n  barChart.setPosition(`A1`, `R${numberOfQuestions * 2}`)\n\n  let offset = -1;\n  for (let i = 0; i < numberOfQuestions;i++)\n  {\n    offset = (i * 16) + (numberOfQuestions * 2) + 2;\n    //New table \n    graphsSheet.getCell(offset + 2, 0).setValue(reportSheet.getRange(`A${i + 2}`).getValue().toString())\n    graphsSheet.getCell(offset + 1, 1).setValue(`=Report!E1:I1`);\n    graphsSheet.getCell(offset + 2, 1).setValue(`=Report!E${i + 2}:I${i + 2}`);\n\n    let pieChart = graphsSheet.addChart(ExcelScript.ChartType.pie, graphsSheet.getRange(`A${offset + 2}:F${offset+3}`));\n    pieChart.setPosition(`A${offset}`);\n    pieChart.getTitle().setText( graphsSheet.getCell(offset + 2, 0).getValue().toString()  );\n    pieChart.getDataLabels().setPosition(ExcelScript.ChartDataLabelPosition.outsideEnd);\n    let series = pieChart.addChartSeries(null, null);\n    //series.setXAxisValues(reportSheet.getRange(`E${i + 2}:I${i + 2}`));\n\n    // let pieChart = graphsSheet.addChart(ExcelScript.ChartType.pie, reportSheet.getRange('E1:I1'));\n    // pieChart.setPosition(`A${offset}`);\n    // pieChart.getTitle().setText(reportSheet.getRange(`A${i+2}`).getValue().toString());\n    // pieChart.getDataLabels().setPosition(ExcelScript.ChartDataLabelPosition.outsideEnd);\n    // let series = pieChart.addChartSeries(null, null);\n    // series.setXAxisValues(reportSheet.getRange(`E${i + 2}:I${i + 2}`));\n  }\n}","description":"","parameterInfo":"{\"originalParameterOrder\":[],\"parameterSchema\":{\"type\":\"object\",\"default\":{},\"x-ms-visibility\":\"internal\"},\"returnSchema\":{\"type\":\"object\",\"properties\":{}}}","apiInfo":"{\"variant\":\"synchronous\",\"variantVersion\":2}"}